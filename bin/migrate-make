#!/usr/bin/env node

var program = require('commander'),
    settings = require('../middguard/config/settings'),
    knexConfig = require('../knexfile')[settings.env],
    knex = require('knex')(knexConfig);

program
  .version('0.0.1')
  .option('-n, --name <name>', 'The name for the new migration')
  .option('--model <model>', 'Make a new migration for <model>')
  .option('--middguard', 'Make a new migration for MiddGuard')
  .parse(process.argv);

  console.assert(program.name && program.name !== '',
    'Specify a name for the migration with --name <name>');

var migrationsConfig = require('./utils/migrations_config')(program);
knex.migrate.make(program.name, migrationsConfig).then(function (name) {
  console.log(chalk.green('Created migration: ' + name));
  process.exit(0);
}).catch(function () {
  chalk.red('Error creating migration');
  process.exit(1);
});
